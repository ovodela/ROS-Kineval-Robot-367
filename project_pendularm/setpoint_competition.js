your_name_here = "Anthony Opipari";

document.write('<section class="form_cdy0yw__form_container" id="form_cdy0yw__form_container" style="visibility: hidden;">\
    <form id="form_cdy0yw__form" class="form_cdy0yw__form" method="POST" action="https://sheetdb.io/api/v1/c8lfkt7ob181l" onsubmit="">\
        <label for="form_cdy0yw__form_input_0" class="form_cdy0yw__form_label"> Name </label> <input type="text" name="data[Name]" id="form_cdy0yw__form_input_0" class="form_cdy0yw_form_input" placeholder="" autocomplete="off" />\
        <label for="form_cdy0yw__form_input_1" class="form_cdy0yw__form_label"> Score </label> <input type="text" name="data[Score]" id="form_cdy0yw__form_input_1" class="form_cdy0yw_form_input" placeholder="" autocomplete="off" />\
        <div style="display: flex; align-items: center; justify-content: space-between;">\
            <button type="submit" class="form_cdy0yw__form_input_submit" style="margin-right: 10px;">Submit</button>\
            <div class="form_cdy0yw__form_made_by">\
                <a href="https://sheetdb.io?utm_source=snippet&amp;utm_medium=website&amp;utm_campaign=form">\
                    We use\
                    <svg version="1.1" role="img" width="22" height="22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" xml:space="preserve" style="display: inline;">\
                        <title>SheetDB API</title>\
                        <desc>Make a form out of a Google Spreadsheet API</desc>\
                        <circle fill="#0BAB65" class="st0" cx="50" cy="50" r="46"></circle>\
                        <path\
                            fill="#FFFFFF"\
                            d="M62.2,28.4c0.2,0,0.5,0.1,0.7,0.2c4.5,0.6,8.3,4.2,9.2,8.7c0.1,0.8,0.2,1.5,0.2,2.3c0,0.9-0.1,1.7,0.1,2.6 c0.5,2.6,2.6,4.7,5.2,5.1c0,0,0.1,0,0.1,0c0.4,0.1,0.4,0.1,0.4,0.4c0,1.3,0,2.6,0,3.9c0,0.3,0,0.3-0.3,0.4 c-2.6,0.4-4.6,2.3-5.3,4.8c-0.1,0.5-0.1,1.1-0.2,1.6c0,0.8,0,1.5,0,2.3c-0.2,2.2-1,4.2-2.4,6c-1.8,2.2-4.1,3.5-6.9,4 c-0.6,0.1-1.1,0.1-1.7,0.1c-2.3,0-4.5,0-6.8,0c0,0-0.1,0-0.1,0c-0.3,0-0.3,0-0.3-0.3c0-1.3,0-2.7,0-4c0-0.3,0-0.3,0.4-0.3 c2.3,0,4.6,0,6.9,0c1.4,0,2.7-0.4,3.9-1.3c1.5-1.1,2.3-2.6,2.5-4.5c0.1-0.7,0-1.4,0-2.1c0-3.5,1.4-6.3,4-8.5c0,0,0.1-0.1,0.1-0.1 c0-0.2-0.2-0.2-0.3-0.3c-2.1-1.7-3.3-4-3.8-6.6c-0.1-0.6-0.1-1.1-0.1-1.7c0-0.7,0-1.4,0-2.1c-0.2-2.2-1.2-3.8-3-5 c-1-0.6-2.1-0.9-3.2-0.9c-2.3,0-4.5,0-6.8,0c-0.1,0-0.2,0-0.3,0C54,33.1,54,33,54,32.8c0-0.5,0-1,0-1.5c0-1,0-2,0-2.9 C56.7,28.4,59.4,28.4,62.2,28.4z"\
                        ></path>\
                        <path\
                            fill="#FFFFFF"\
                            d="M44.5,28.4c0,1,0,2.1,0,3.1c0,0.4,0,0.9,0,1.3c0,0.2-0.1,0.3-0.3,0.3c-0.2,0-0.4,0-0.6,0c-2.1,0-4.2,0-6.4,0 c-2.8,0-5.4,1.9-6.2,4.7c-0.1,0.5-0.2,1.1-0.2,1.6c0,0.6,0,1.3,0,1.9c-0.1,2.6-1,4.9-2.6,6.8c-0.5,0.5-1,1-1.5,1.5 c0,0.1,0.1,0.2,0.2,0.3c2,1.7,3.3,3.9,3.8,6.5c0.1,0.6,0.2,1.3,0.2,2c0,0.8,0,1.6,0.1,2.3c0.3,2.6,2.3,4.7,4.8,5.4 c0.5,0.1,1,0.2,1.6,0.2c2.2,0,4.4,0,6.6,0c0.1,0,0.2,0,0.3,0c0.2,0,0.2,0.1,0.2,0.2c0,0.1,0,0.1,0,0.2c0,1.3,0,2.6,0,3.8 c0,0.4,0,0.4-0.4,0.4c-2.4,0-4.7,0-7.1,0c-5.1-0.1-9.3-3.5-10.5-8.4c-0.2-0.7-0.3-1.5-0.3-2.2c0-0.7,0-1.3,0-2 c0-2.9-2.2-5.5-5.1-6.1c-0.7-0.1-0.7-0.1-0.7-0.8c0-1.1,0-2.3,0-3.4c0-0.6,0-0.6,0.5-0.7c1.8-0.3,3.2-1.3,4.2-2.8 c0.7-1,1-2.2,1-3.4c0-0.6,0-1.2,0-1.8c0.1-5.3,4-9.6,8.8-10.5c0.4-0.1,0.8-0.1,1.1-0.2c0.1,0,0.3-0.1,0.5-0.1 C39.4,28.4,41.8,28.4,44.5,28.4z"\
                        ></path>\
                        <path\
                            fill="#FFFFFF"\
                            d="M49.2,38.1c4.1,0,8.3,0,12.4,0c0.1,0,0.2,0,0.3,0c0.2,0,0.2,0.1,0.2,0.2c0,0.4,0,0.7,0,1.1c0,1,0,2,0,2.9 c0,0.4,0,0.4-0.4,0.4c-1.4,0-2.8,0-4.2,0c-6.9,0-13.8,0-20.8,0c-0.1,0-0.1,0-0.2,0c-0.6,0-0.5,0-0.5-0.5c0-1.2,0-2.5,0-3.7 c0-0.4,0-0.4,0.4-0.4C40.8,38.1,45,38.1,49.2,38.1z"\
                        ></path>\
                        <path\
                            fill="#FFFFFF"\
                            d="M49.2,61.2c-4.1,0-8.3,0-12.4,0c-0.7,0-0.6,0.1-0.6-0.6c0-1.2,0-2.5,0-3.7c0-0.3,0-0.3,0.3-0.3 c0.1,0,0.1,0,0.2,0c8.3,0,16.6,0,24.9,0c0.6,0,0.5-0.1,0.5,0.6c0,1.2,0,2.4,0,3.6c0,0.5,0,0.4-0.4,0.4 C57.6,61.2,53.4,61.2,49.2,61.2z"\
                        ></path>\
                        <path\
                            fill="#FFFFFF"\
                            d="M42.1,52c-1.8,0-3.5,0-5.3,0c-0.1,0-0.2,0-0.3,0c-0.3,0-0.3,0-0.3-0.3c0-0.6,0-1.1,0-1.7c0-0.8,0-1.5,0-2.3 c0-0.4,0-0.4,0.3-0.4c1.1,0,2.2,0,3.3,0c2.5,0,5,0,7.6,0c0.1,0,0.2,0,0.3,0c0.3,0,0.3,0,0.3,0.3c0,0.5,0,1,0,1.5c0,0.8,0,1.6,0,2.4 c0,0.4,0,0.4-0.4,0.4C45.7,52,43.9,52,42.1,52z"\
                        ></path>\
                        <path\
                            fill="#FFFFFF"\
                            d="M55.7,47.4c0.8,0,1.6,0,2.4,0c0.3,0,0.3,0,0.3,0.3c0,1.3,0,2.6,0,4c0,0.3,0,0.3-0.3,0.3c-1.6,0-3.2,0-4.8,0 C53,52,53,52,53,51.7c0-1.3,0-2.7,0-4c0-0.3,0-0.3,0.4-0.3C54.1,47.4,54.9,47.4,55.7,47.4z"\
                        ></path>\
                    </svg>\
                    SheetDB Forms\
                </a>\
            </div>\
        </div>\
    </form>\
</section>\
');
window.setTimeout(function() {
	form_cdy0yw_snippet_form = document.getElementById("form_cdy0yw__form");
	form_cdy0yw_snippet_loading = document.getElementById("form_cdy0yw_snippet_loading");
	form_cdy0yw_snippet_thank_you = document.getElementById("form_cdy0yw_snippet_thank_you");
	form_cdy0yw_error = document.getElementById("form_cdy0yw_snippet_error");
}, 0);
function submitForm() {
    fetch(form_cdy0yw_snippet_form.action, { method: "POST", body: new FormData(form_cdy0yw_snippet_form) }).then((response) => {
        if (response.status === 200 || response.status === 201) {
            form_cdy0yw_snippet_loading.style.display = "none";
            form_cdy0yw_snippet_thank_you.style.display = "block";
        } else {
            form_cdy0yw_snippet_loading.style.display = "none";
            form_cdy0yw_error.style.display = "flex";
        }
    });
}

submitted = true;

function administerCompetition(pendulum) {
	if (typeof competition === 'undefined') {
		competition = {state: "not_satisfied", satisfiedTime: null, setpointsReached: 0, startTime: Date.now()}
	}

	// if (typeof renderer_plot === "undefined") {
	// 	updateScene()
	// }



	checkSetpoint(pendulum)
}

function satisfiedTest(pendulum) {
	angle_threshold = 1e-2;
	angle_test = Math.abs(pendulum.angle - pendulum.desired) < angle_threshold;

	angle_dot_threshold = 1e-2;
	angle_dot_test = Math.abs(pendulum.angle_dot) < angle_dot_threshold;

	return angle_test && angle_dot_test;
}


function checkSetpoint(pendulum) {
	textbar.innerHTML += "<br><br> Competition" +
						 "<br>" +
            			 " setpointsReached = " + competition.setpointsReached +
            			 "<br>" +
            			 " setpointsAverage = " + (60 * competition.setpointsReached / (1e-3 * (Date.now() - competition.startTime))).toFixed(2)

	if (satisfiedTest(pendulum)) {
		if (competition.state === "not_satisfied") {
			competition.state = "satisfied";
			competition.satisfiedTime = Date.now();
			return
		}
		// else {
		if (Date.now() - competition.satisfiedTime >= 50) {
			competition.setpointsReached += 1;
			competition.state = "not_satisfied";
			competition.satisfiedTime = null;
			pendulum.desired = ((Math.random() * 2) - 1) * 2 * Math.PI;
		}
	}

	if((1e-3 * (Date.now() - competition.startTime)) % 60 < 5 && servo_active_state == "active") {
		if(!submitted) {
			// //https://docs.google.com/forms/d/e/1FAIpQLScXBVA4g08ILIxItPfwXysRlW5baLDNKQn9qASN8PUYahFf-Q/viewform?usp=pp_url&entry.1564464553=name&entry.1951419686=43
			// link_part_1 = "https://docs.google.com/forms/d/e/1FAIpQLScXBVA4g08ILIxItPfwXysRlW5baLDNKQn9qASN8PUYahFf-Q/viewform?usp=pp_url&entry.1564464553=";
			// your_name_here = "tommy cohn";
			// link_part_2 = "&entry.1951419686=";
			// score = (60 * competition.setpointsReached / (1e-3 * (Date.now() - competition.startTime))).toFixed(2);
			// link_part_3 = "&submit=Submit";
			// url = link_part_1 + your_name_here + link_part_2 + score + link_part_3;

			// var opts = {
			// 	method: "GET",
			// 	mode: "no-cors" // apparently Google will only submit a form if "mode" is "no-cors"
			// };
			// fetch(url, opts);

			// alert(url);

			
			score = (60 * competition.setpointsReached / (1e-3 * (Date.now() - competition.startTime))).toFixed(2);

			document.getElementById("form_cdy0yw__form_input_0").value = your_name_here;
			document.getElementById("form_cdy0yw__form_input_1").value = score;
			// document.getElementById("form_cdy0yw__form").submit();
			submitForm();

			submitted = true;
		}
	}
	else {
		if(submitted) {
			submitted = false;
		}
	}
}
